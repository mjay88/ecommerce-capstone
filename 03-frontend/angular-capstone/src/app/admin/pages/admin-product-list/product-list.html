<div class="main-content">
  <div class="section-content section-content-p30">
    <div class="container-fluid">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="m-0">Products</h2>

        <a class="btn btn-primary" routerLink="/admin/products/new"> Add Product </a>
      </div>

      @if (loading) {
        <div class="alert alert-info">Loading…</div>
      }

      @if (errorMsg) {
        <div class="alert alert-danger">{{ errorMsg }}</div>
      }

      @if (!loading && !errorMsg) {
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th style="width: 90px">ID</th>
                <th style="width: 80px">Image</th>
                <th>Name</th>
                <th style="width: 140px">Category</th>
                <th style="width: 120px" class="text-end">Price</th>
                <th style="width: 120px" class="text-end">Stock</th>
                <th style="width: 90px" class="text-center">Active</th>
                <th style="width: 220px" class="text-end">Actions</th>
              </tr>
            </thead>

            <tbody>
              @for (p of products; track p.id) {
                <tr>
                  <td>{{ p.id }}</td>

                  <td>
                    @if (p.imageUrl) {
                      <img
                        [src]="p.imageUrl"
                        alt="product image"
                        style="width: 56px; height: 56px; object-fit: cover; border-radius: 8px"
                      />
                    } @else {
                      <span class="text-muted">—</span>
                    }
                  </td>

                  <td>{{ p.name }}</td>

                  <td>
                    {{ p.category?.categoryName }}
                  </td>

                  <td class="text-end">
                    {{ p.unitPrice | number: '1.2-2' }}
                  </td>

                  <td class="text-end">
                    {{ p.unitsInStock }}
                  </td>

                  <td class="text-center">
                    @if (p.active) {
                      ✅
                    } @else {
                      ❌
                    }
                  </td>

                  <td class="text-end">
                    <a
                      class="btn btn-sm btn-outline-secondary me-2"
                      [routerLink]="['/admin/products', p.id]"
                    >
                      Edit
                    </a>

                    <button
                      class="btn btn-sm btn-outline-danger"
                      (click)="deleteProduct(p)"
                      [disabled]="saving"
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              }

              @if (products.length === 0) {
                <tr>
                  <td colspan="8" class="text-center text-muted py-4">No products found.</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  </div>
</div>
